<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jonathan Berdejo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;900&display=swap" rel="stylesheet"/>
<meta name="color-scheme" content="dark">
<style>
/* ===== Reset & Vars ===== */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
html{scroll-behavior:smooth}
:root{
  --bpm:72; --beat: calc(60s/var(--bpm));
  --neon:#00eaff; --bg:#000; --txt:#eaf6ff; --stroke: rgba(0,234,255,.18);
  --neonline:#ff1744;
}
body{font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--txt);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden}

/* ===== Fondo ===== */
.neon-bg{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none;background:
  radial-gradient(1200px 600px at 50% 60%, rgba(0,234,255,.06), transparent 70%)}
.stars{position:absolute;inset:0;pointer-events:none}
.star{position:absolute;width:2px;height:2px;border-radius:50%;background:#fff;opacity:0;filter:drop-shadow(0 0 6px rgba(255,255,255,.6));animation:twinkle var(--tw,3.5s) ease-in-out infinite var(--td,0s);transform:scale(var(--sc,1))}
@keyframes twinkle{0%,100%{opacity:0}10%{opacity:.9}50%{opacity:.3}90%{opacity:1}}
.neon-lines{position:absolute;inset:0;pointer-events:none}
.beam{position:absolute;left:-60vw;width:80vw;height:4px;opacity:.18;filter:blur(1.5px) brightness(1.2);mix-blend-mode:screen;transform:translateX(-40vw);background:linear-gradient(90deg,transparent 0%, var(--neon) 40%, var(--neon) 60%, transparent 100%);animation:beamX var(--s,2.2s) linear infinite}
.b1{top:22%;--s:1.8s}.b2{top:38%;--s:2.1s}.b3{top:54%;--s:2.4s}.b4{top:70%;--s:2.8s}.b5{top:86%;--s:3.2s}
@keyframes beamX{from{transform:translateX(-40vw)}to{transform:translateX(120vw)}}
#starLinkCanvas{position:absolute; inset:0; width:100%; height:100%; display:block}

/* ===== Contenido ===== */
.nav,.hero,.section,.footer,.hud-nav{position:relative;z-index:5}
.hero{min-height:100vh;display:grid;place-items:center;text-align:center}
.title{font-weight:900;letter-spacing:.04em;font-size:clamp(2.8rem,9vw,6.4rem);color:#e8fdff;text-shadow:0 0 18px var(--neon),0 0 48px var(--neon),0 0 120px var(--neon);animation:titleBeat var(--beat) ease-in-out infinite}
@keyframes titleBeat{0%{transform:scale(1)}8%{transform:scale(1.015)}18%{transform:scale(1.009)}26%,100%{transform:scale(1)}}

.section{padding:96px 20px}
.container{max-width:1100px;margin:0 auto}
.card{background:rgba(0,0,0,.08);border:1px solid rgba(0,234,255,0.18);border-radius:18px;padding:24px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
.section h2{font-weight:800;letter-spacing:.02em;margin-bottom:14px;color:#eafcff;text-shadow:0 0 14px rgba(0,234,255,.6)}
.grid{display:grid;gap:18px}
.grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.badges{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.badge{border:1px solid var(--stroke);padding:6px 10px;border-radius:999px;font-size:.9rem;background:rgba(0,234,255,.06)}
.actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid var(--neon);border-radius:12px;padding:10px 14px;font-weight:700;color:#001a1f;background:linear-gradient(90deg,#00eaff,#8ff6ff);text-decoration:none;box-shadow:0 0 18px rgba(0,234,255,.35);cursor:pointer}
.btn--ghost{background:transparent;color:#bfe7f1;border-color:var(--stroke)}
.footer{padding:40px 20px;color:#a9d7e5;text-align:center;border-top:1px solid var(--stroke)}

/* ===== HUD ===== */
.hud-nav{position:fixed;bottom:22px;left:50%;transform:translateX(-50%);z-index:6;display:flex;gap:18px;padding:10px 14px;background:rgba(0,0,0,.35);
  backdrop-filter: blur(10px) saturate(120%);-webkit-backdrop-filter: blur(10px) saturate(120%);border:1px solid rgba(0,234,255,.22);border-radius:999px;box-shadow:0 0 24px rgba(0,234,255,.18), inset 0 0 10px rgba(0,234,255,.08)}
.hud-nav a{position:relative;color:#c9faff;text-decoration:none;font-weight:700;letter-spacing:.02em;padding:8px 12px;border-radius:10px;transition: color .2s ease, background .2s ease, text-shadow .2s ease}
.hud-nav a:hover{color:#001a1f;background:linear-gradient(90deg,#00eaff,#8ff6ff);text-shadow:0 0 12px #00eaff}
.hud-nav a.active{color:#eaffff;text-shadow:0 0 10px #00eaff, 0 0 24px #00eaff}
.hud-indicator{position:absolute;left:0;bottom:6px;height:2px;border-radius:2px;width:var(--indW,40px);transform:translateX(var(--indX,0));background:linear-gradient(90deg,transparent,#00eaff,transparent);box-shadow:0 0 14px #00eaff;transition: transform .25s ease, width .25s ease}

/* ===== Barra superior ===== */
#topBar{
  position:fixed;top:20px;right:26px;z-index:7;display:flex;gap:8px;align-items:center;
  background:rgba(0,0,0,.4);backdrop-filter: blur(6px);
  border:1px solid rgba(0,234,255,.25);border-radius:12px;padding:4px 8px;box-shadow:0 0 18px rgba(0,234,255,.25)
}
#langSwitcher{background:transparent;color:#00eaff;border:none;font-weight:700;font-size:.95rem;letter-spacing:.04em;cursor:pointer}
#langSwitcher option{background:#000;color:#00eaff}
#animToggle{font-weight:700;color:#00eaff;background:transparent;border:1px solid rgba(0,234,255,.25);border-radius:10px;padding:6px 10px;cursor:pointer}

/* ===== Accordion ===== */
.acc{display:grid;gap:12px;margin-top:12px}
.acc-item{border:1px solid rgba(0,234,255,.14);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.12)}
.acc-h{width:100%;text-align:left;background:transparent;border:none;color:#eafcff;padding:12px 16px;font-weight:700;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.acc-h span{opacity:.8;font-weight:600}
.acc-c{max-height:0;overflow:hidden;transition:max-height .28s ease}
.acc-item.open .acc-c{max-height:500px}
.acc-list{padding:8px 16px 16px 28px;opacity:.95;line-height:1.6}
.acc-h .chev{transition:transform .25s ease}
.acc-item.open .chev{transform:rotate(90deg)}

/* ===== Motion OFF ===== */
body[data-motion="off"] .star,
body[data-motion="off"] .beam,
body[data-motion="off"] .title{animation:none!important;}
body[data-motion="off"] #starLinkCanvas{display:none}
@media (prefers-reduced-motion: reduce){
  .star,.beam,.title{animation:none!important}
  #starLinkCanvas{display:none}
}

/* ===== Carrusel ‚ÄúSobre m√≠‚Äù (CSS) ===== */
.about-grid{display:grid;gap:18px;grid-template-columns:1.05fr .95fr}
@media (max-width:900px){ .about-grid{grid-template-columns:1fr} }

.carousel{position:relative;border:1px solid var(--stroke);border-radius:16px;overflow:hidden;background:rgba(0,0,0,.22)}
.carousel__track{display:flex;transition:transform .35s ease;will-change:transform}
.carousel__slide{flex:0 0 100%;position:relative;aspect-ratio:4/3;background:#05080a}
.carousel__slide img{width:100%;height:100%;object-fit:cover;display:block;filter:contrast(1.08) brightness(.95)}
/* Ocultar controles (existen en HTML por accesibilidad) */
.carousel__btn,.carousel__dots{display:none!important}

/* Back to Top */
.backtop{
  position:fixed; right:22px; bottom:92px; z-index:8;
  width:44px; height:44px; border-radius:12px; cursor:pointer;
  border:1px solid var(--stroke); background:rgba(0,0,0,.45);
  color:#c9faff; font-size:20px; font-weight:900; line-height:44px; text-align:center;
  box-shadow:0 0 18px rgba(0,234,255,.18);
  opacity:0; transform:translateY(10px); pointer-events:none;
  transition:opacity .22s ease, transform .22s ease, box-shadow .15s ease;
  backdrop-filter: blur(8px) saturate(120%);
}
.backtop:hover{box-shadow:0 0 0 3px rgba(0,234,255,.12), 0 0 22px rgba(0,234,255,.25) inset}
.backtop.is-visible{opacity:1;transform:translateY(0);pointer-events:auto}
@media (max-width:900px){ .backtop{ bottom:86px; right:16px } }
</style>
</head>
<body>
  <!-- Top bar -->
  <div id="topBar" role="toolbar" aria-label="Preferencias">
   <select id="langSwitcher" aria-label="Idioma">
  <option value="es" selected>ES</option>
  <option value="en">EN</option>
</select>

    <button id="animToggle" type="button" aria-pressed="false"
        title="Activar o desactivar animaci√≥n"
        data-on-label="‚ö° ON"
        data-off-label="üåô OFF">‚ö° Animaci√≥n: ON</button>
  </div>

  <!-- Fondo -->
  <div class="neon-bg" aria-hidden="true">
    <div class="stars"></div>
    <div class="neon-lines">
      <span class="beam b1"></span><span class="beam b2"></span><span class="beam b3"></span><span class="beam b4"></span><span class="beam b5"></span>
    </div>
    <canvas id="starLinkCanvas" aria-hidden="true"></canvas>
  </div>

  <!-- HUD -->
  <nav class="hud-nav" aria-label="Principal">
    <a href="#home"   data-link data-t="navHome">Inicio</a>
    <a href="#about"  data-link data-t="navAbout">Sobre m√≠</a>
    <a href="#work"   data-link data-t="navWork">Experiencia</a>
    <a href="#skills" data-link data-t="navSkills">Competencias</a>
    <a href="#contact"data-link data-t="navContact">Contacto</a>
    <span class="hud-indicator" aria-hidden="true"></span>
  </nav>

  <!-- Hero -->
  <header id="home" class="hero">
    <h1 class="title">JONATHAN BERDEJO</h1>
  </header>

  <!-- Sobre m√≠ -->
  <section id="about" class="section">
    <div class="container">
      <div class="card">
        <div class="about-grid">
          <div>
            <h2 data-t="aboutTitle">Sobre m√≠</h2>
            <p data-t="aboutText">
              Soy apasionado en todo lo que hago. Tengo 24 a√±os y me mueven la curiosidad y la mejora continua: analizar, estructurar y administrar datos. Desde mi adolescencia he dedicado mi tiempo libre a la escritura, la m√∫sica y la tecnolog√≠a, de forma autodidacta m√°s formaciones complementarias. Del mismo modo que mis habilidades t√©cnico-creativas son tangibles, mi experiencia y formaci√≥n en log√≠stica han fortalecido mi capacidad de organizaci√≥n, gesti√≥n y resoluci√≥n pr√°ctica.
            </p>
            <div class="badges" id="aboutBadges"></div>
          </div>

          <!-- Carrusel lateral -->
          <figure class="carousel" aria-label="Galer√≠a de fotos - Sobre m√≠">
            <div class="carousel__track" id="aboutTrack">
              <div class="carousel__slide">
                <img src="assets/images/jonpiano2.png" alt="" loading="lazy" decoding="async" />
              </div>
              <div class="carousel__slide">
                <img src="assets/images/Jonpiano3.png" alt="" loading="lazy" decoding="async" />
              </div>
              <div class="carousel__slide">
                <img src="assets/images/jonpiano1.png" alt="" loading="lazy" decoding="async" />
              </div>
            </div>
            <!-- Controles presentes pero ocultos por CSS -->
            <button class="carousel__btn carousel__btn--prev" aria-label="Anterior">‚Äπ</button>
            <button class="carousel__btn carousel__btn--next" aria-label="Siguiente">‚Ä∫</button>
            <div class="carousel__dots" id="aboutDots" role="tablist" aria-label="Paginaci√≥n del carrusel"></div>
          </figure>

        </div>
      </div>
    </div>
  </section>

  <!-- Experiencia / Servicios + Qu√© aporto -->
  <section id="work" class="section">
    <div class="container">
      <div class="card">
        <h2 data-t="workTitle">Experiencia & Servicios</h2>
        <div class="grid grid-2">
          <div>
            <h3 data-t="recentExp">Experiencia reciente</h3>
            <ul data-t="expList">
              <li>Log√≠stica y calidad (DHL): recepci√≥n de mercanc√≠a, control de stock y trazabilidad.</li>
              <li>Gesti√≥n de incidencias y registro en Excel/ERP.</li>
              <li>Apoyo administrativo: documentaci√≥n, correo biling√ºe y coordinaci√≥n de tareas y equipos.</li>
            </ul>
          </div>
          <div>
            <h3 data-t="services">Servicios</h3>
            <ul data-t="svcList">
              <li>Data entry y asistencia administrativa remota.</li>
              <li>Reporting operativo y hojas de c√°lculo.</li>
              <li>Coordinaci√≥n de procesos y liderazgo operativo.</li>
            </ul>
            <h3 style="margin-top:14px" data-t="offerTitle">Qu√© puedo aportar</h3>
            <ul data-t="offerList">
              <li>Precisi√≥n y mecanograf√≠a +110 WPM para captura de datos fiable.</li>
              <li>Optimizaci√≥n de flujos y reporting claro orientado a KPIs/SLAs.</li>
              <li>Comunicaci√≥n profesional en espa√±ol e ingl√©s (C1).</li>
            </ul>
          </div>
        </div>

        <!-- Botones -->
        <div class="actions" style="margin-top:18px">
          <a class="btn" href="#contact" data-t="btnTalk">Hablemos</a>
          <a class="btn btn--ghost" href="assets/docs/CVJBS.pdf" target="_blank" rel="noopener">Ver CV</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Competencias -->
  <section id="skills" class="section">
    <div class="container">
      <div class="card">
        <h2 data-t="skillsTitle">Competencias</h2>
        <div class="acc" id="skillsAcc"></div>
      </div>
    </div>
  </section>

  <!-- Contacto -->
  <section id="contact" class="section">
    <div class="container">
      <div class="card">
        <h2 data-t="contactTitle">Contacto</h2>
        <p data-t="contactText">¬øColaboramos? Te respondo en el mismo d√≠a laboral.</p>
        <div class="actions">
          <a class="btn" href="mailto:berdejosanchez@gmail.com?subject=Contacto%20-%20Jonathan%20Berdejo" data-t="btnEmail">Enviar email</a>
          <a class="btn btn--ghost" href="https://www.linkedin.com/in/" target="_blank" rel="noopener" data-t="btnLinkedIn">LinkedIn</a>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">¬© <span id="year"></span> Jonathan Berdejo</footer>

  <!-- Back to Top -->
  <button id="backTop" class="backtop" aria-label="Volver arriba" title="Volver arriba">‚Üë</button>

<script>
/* ========== A√±o ========== */
document.getElementById('year').textContent = new Date().getFullYear();

/* ========== Estados globales ========== */
const MOTION_KEY = 'motionPref';
let motionOff = false;

/* ========== Estrellas ========== */
(function(){
  const wrap = document.querySelector('.stars'); if(!wrap) return;
  const isMobile = matchMedia('(max-width: 900px)').matches; const N = isMobile ? 120 : 220;
  const frag = document.createDocumentFragment();
  for (let i=0;i<N;i++){
    const s=document.createElement('i'); s.className='star';
    s.style.left=(Math.random()*100).toFixed(3)+'%';
    s.style.top=(Math.random()*100).toFixed(3)+'%';
    s.style.setProperty('--sc',(0.6+Math.random()*1.8).toFixed(2));
    s.style.setProperty('--tw',(1.8+Math.random()*4.8).toFixed(2)+'s');
    s.style.setProperty('--td',(Math.random()*6).toFixed(2)+'s');
    frag.appendChild(s);
  }
  wrap.appendChild(frag);
})();

/* ========== HUD activo + indicador ========== */
(function(){
  const links=[...document.querySelectorAll('.hud-nav a[data-link]')];
  const ind=document.querySelector('.hud-indicator'); if(!links.length||!ind) return;
  function setActiveByHash(hash){
    links.forEach(a=>a.classList.toggle('active',a.getAttribute('href')===hash));
    const active=links.find(a=>a.classList.contains('active'))||links[0];
    const r=active.getBoundingClientRect(); const navR=active.parentElement.getBoundingClientRect();
    ind.style.setProperty('--indX',(r.left-navR.left+8)+'px'); ind.style.setProperty('--indW',(r.width-16)+'px');
  }
  const sections=links.map(a=>document.querySelector(a.getAttribute('href'))).filter(Boolean);
  function onScroll(){let cur='#home'; for(const sec of sections){const rect=sec.getBoundingClientRect();
    if(rect.top<=innerHeight*0.38 && rect.bottom>=innerHeight*0.38){cur='#'+sec.id;break;}} setActiveByHash(cur);}
  links.forEach(a=>a.addEventListener('click',()=>setActiveByHash(a.getAttribute('href'))));
  window.addEventListener('scroll',onScroll,{passive:true}); window.addEventListener('resize',onScroll); onScroll();
})();

/* ========== Textos ES/EN ========== */
const T = {
  es:{ navHome:"Inicio", navAbout:"Sobre m√≠", navWork:"Experiencia", navSkills:"Competencias", navContact:"Contacto",
    aboutTitle:"Sobre m√≠",
    aboutText:"Soy apasionado en todo lo que hago. Tengo 24 a√±os y me mueven la curiosidad y la mejora continua: analizar, estructurar y administrar datos. Desde mi adolescencia he dedicado mi tiempo libre a la escritura, la m√∫sica y la tecnolog√≠a, de forma completamente autodidacta. Del mismo modo que mis habilidades t√©cnico-creativas son tangibles, mi experiencia y formaci√≥n en log√≠stica han fortalecido mi capacidad de organizaci√≥n, gesti√≥n y resoluci√≥n pr√°ctica.",
    badges:["Excel avanzado","Google Workspace","ERP / SAP (b√°sico)","Data entry","Atenci√≥n al cliente","Coordinaci√≥n log√≠stica"],
    workTitle:"Experiencia & Servicios", recentExp:"Experiencia reciente",
    expList:[
      "Log√≠stica y calidad (DHL): recepci√≥n, control de stock y trazabilidad.",
      "Gesti√≥n de incidencias y registro en Excel/ERP.",
      "Apoyo administrativo: documentaci√≥n, correo biling√ºe y coordinaci√≥n de tareas y equipos."
    ],
    services:"Servicios",
    svcList:[
      "Data entry y asistencia administrativa remota.",
      "Reporting operativo y hojas de c√°lculo.",
      "Coordinaci√≥n de procesos y liderazgo operativo."
    ],
    offerTitle:"Qu√© puedo aportar",
    offerList:[
      "Precisi√≥n y mecanograf√≠a +110 WPM para captura de datos fiable.",
      "Optimizaci√≥n de flujos y reporting claro orientado a KPIs/SLAs.",
      "Comunicaci√≥n profesional en espa√±ol e ingl√©s (C1)."
    ],
    skillsTitle:"Competencias",
    skillsCats:[
      {title:"üñ•Ô∏è Ofim√°tica y gesti√≥n digital", items:[
        "Excel avanzado (tablas din√°micas, f√≥rmulas, bases de datos, trazabilidad)",
        "Google Workspace (Docs, Sheets, Drive, Calendar, Gmail profesional)",
        "Microsoft Office (Word, PowerPoint, Outlook, Access)",
        "Herramientas ERP / SAP (nivel b√°sico)",
        "Gesti√≥n documental digital y archivado estructurado",
        "Redacci√≥n profesional y correcci√≥n de textos",
        "Data entry con alta precisi√≥n y mecanograf√≠a de +100 WPM"
      ]},
      {title:"üíº Administraci√≥n y soporte", items:[
        "Organizaci√≥n y priorizaci√≥n de tareas",
        "Elaboraci√≥n de informes, facturas y documentos",
        "Control de inventarios y seguimiento de pedidos",
        "Gesti√≥n de agendas, calendarios y correos corporativos",
        "Coordinaci√≥n de reuniones y comunicaci√≥n interna",
        "Registro y actualizaci√≥n de bases de datos",
        "Supervisi√≥n de procesos y control de calidad"
      ]},
      {title:"üåç Trabajo remoto y comunicaci√≥n", items:[
        "Comunicaci√≥n biling√ºe espa√±ol‚Äìingl√©s (C1 Cambridge)",
        "Atenci√≥n al cliente digital (chat, correo, videollamada)",
        "Resoluci√≥n de incidencias con claridad y empat√≠a",
        "Gesti√≥n del tiempo y autonom√≠a en entornos online",
        "Adaptaci√≥n a distintos husos horarios y equipos internacionales",
        "Herramientas colaborativas: Slack, Trello, Notion, Asana, Zoom, Meet"
      ]},
      {title:"‚öôÔ∏è Tecnolog√≠a y programaci√≥n", items:[
        "HTML, CSS y fundamentos de programaci√≥n",
        "Uso de CMS y dise√±o web b√°sico (Canva, WordPress, GitHub Pages)",
        "Conocimientos de bases de datos (MySQL, NoSQL)",
        "Automatizaci√≥n de tareas simples y digitalizaci√≥n de procesos",
        "Mantenimiento y actualizaci√≥n de sitios web"
      ]},
      {title:"üöö Log√≠stica y coordinaci√≥n", items:[
        "Trazabilidad de pedidos y control de stock (DHL)",
        "Coordinaci√≥n log√≠stica y registro de incidencias",
        "Control de calidad y reporte de errores",
        "ERPs log√≠sticos y terminales de mano",
        "Entorno de almac√©n y soporte administrativo"
      ]}
    ],
    contactTitle:"Contacto", contactText:"¬øColaboramos? Te respondo en el mismo d√≠a laboral.",
    btnTalk:"Hablemos", btnEmail:"Enviar email", btnLinkedIn:"LinkedIn"
  },
  en:{ navHome:"Home", navAbout:"About", navWork:"Experience", navSkills:"Skills", navContact:"Contact",
    aboutTitle:"About me",
    aboutText:"I‚Äôm passionate about everything I do. I‚Äôm 24 years old, driven by curiosity and continuous improvement ‚Äî I like to analyze, structure, and manage data. Since my teenage years, I‚Äôve devoted my free time to writing, music, and technology, learning on my own. Just as my technical and creative skills are tangible, my background and experience in logistics have strengthened my sense of organization, management, and practical problem-solving.",
    badges:["Advanced Excel","Google Workspace","ERP / SAP (basic)","Data entry","Customer support","Logistics coordination"],
    workTitle:"Experience & Services", recentExp:"Recent experience",
    expList:[
      "Logistics & quality (DHL): receiving, stock control and traceability.",
      "Issue management and data logging in Excel/ERP.",
      "Admin support: documentation, bilingual email, and task/team coordination."
    ],
    services:"Services",
    svcList:[
      "Data entry & remote admin support.",
      "Operational reporting and spreadsheets.",
      "Process coordination and hands-on team leadership."
    ],
    offerTitle:"What I bring",
    offerList:[
      "High-accuracy typing (110+ WPM) for reliable data capture.",
      "Workflow optimization and KPI/SLAs-oriented reporting.",
      "Professional communication in Spanish and English (C1)."
    ],
    skillsTitle:"Skills",
    skillsCats:[
      {title:"üñ•Ô∏è Office & digital management", items:[
        "Advanced Excel (pivot tables, formulas, data models, traceability)",
        "Google Workspace (Docs, Sheets, Drive, Calendar, professional Gmail)",
        "Microsoft Office (Word, PowerPoint, Outlook, Access)",
        "ERP / SAP tools (basic level)",
        "Digital document management and structured filing",
        "Professional writing and copy-editing",
        "High-accuracy data entry and 100+ WPM typing"
      ]},
      {title:"üíº Administration & support", items:[
        "Task organization and prioritization",
        "Reports, invoices and document drafting",
        "Inventory control and order tracking",
        "Calendar, schedules and corporate email management",
        "Meeting coordination and internal comms",
        "Database recording and updates",
        "Process supervision and quality control"
      ]},
      {title:"üåç Remote work & communication", items:[
        "Bilingual Spanish‚ÄìEnglish communication (C1 Cambridge)",
        "Digital customer support (chat, email, video)",
        "Incident resolution with clarity and empathy",
        "Time management and autonomy in online environments",
        "Adaptation to time zones and international teams",
        "Collab tools: Slack, Trello, Notion, Asana, Zoom, Meet"
      ]},
      {title:"‚öôÔ∏è Technology & programming", items:[
        "HTML, CSS and programming fundamentals",
        "CMS use and basic web design (Canva, WordPress, GitHub Pages)",
        "Database knowledge (MySQL, NoSQL)",
        "Simple task automation and process digitization",
        "Maintenance and updates of personal/professional sites"
      ]},
      {title:"üöö Logistics & coordination", items:[
        "Order traceability and stock control (DHL)",
        "Logistics coordination and incident logging",
        "Quality control and error reporting",
        "Logistics ERPs and handheld terminals",
        "Warehouse environment and admin support"
      ]}
    ],
    contactTitle:"Contact", contactText:"Let's collaborate! I usually reply the same business day.",
    btnTalk:"Let's talk", btnEmail:"Send email", btnLinkedIn:"LinkedIn"
  }
};

/* Helpers */
function renderBadges(arr){
  const c = document.getElementById('aboutBadges');
  c.innerHTML = arr.map(txt=>`<span class="badge">${txt}</span>`).join('');
}
function renderAccordion(cats){
  const acc = document.getElementById('skillsAcc');
  acc.innerHTML = cats.map((cat)=>`
    <div class="acc-item">
      <button class="acc-h" type="button" aria-expanded="false">
        <span>${cat.title}</span>
        <span class="chev">‚Ä∫</span>
      </button>
      <div class="acc-c" role="region" aria-hidden="true">
        <ul class="acc-list">
          ${cat.items.map(li=>`<li>${li}</li>`).join('')}
        </ul>
      </div>
    </div>
  `).join('');
  acc.querySelectorAll('.acc-h').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const item = btn.parentElement;
      const isOpen = item.classList.contains('open');
      acc.querySelectorAll('.acc-item.open').forEach(x=>{
        x.classList.remove('open');
        x.querySelector('.acc-h').setAttribute('aria-expanded','false');
        x.querySelector('.acc-c').setAttribute('aria-hidden','true');
      });
      if(!isOpen){
        item.classList.add('open');
        btn.setAttribute('aria-expanded','true');
        item.querySelector('.acc-c').setAttribute('aria-hidden','false');
      }
    });
  });
}
function applyLang(lang){
  const t=T[lang]||T.es;
  document.querySelector('[data-t="navHome"]').textContent=t.navHome;
  document.querySelector('[data-t="navAbout"]').textContent=t.navAbout;
  document.querySelector('[data-t="navWork"]').textContent=t.navWork;
  document.querySelector('[data-t="navSkills"]').textContent=t.navSkills;
  document.querySelector('[data-t="navContact"]').textContent=t.navContact;

  document.querySelector('[data-t="aboutTitle"]').textContent=t.aboutTitle;
  document.querySelector('[data-t="aboutText"]').textContent=t.aboutText;
  renderBadges(t.badges);

  document.querySelector('[data-t="workTitle"]').textContent=t.workTitle;
  document.querySelector('[data-t="recentExp"]').textContent=t.recentExp;
  document.querySelector('[data-t="services"]').textContent=t.services;
  document.querySelector('[data-t="offerTitle"]').textContent=t.offerTitle;

  document.querySelector('[data-t="expList"]').innerHTML = t.expList.map(li=>`<li>${li}</li>`).join('');
  document.querySelector('[data-t="svcList"]').innerHTML = t.svcList.map(li=>`<li>${li}</li>`).join('');
  document.querySelector('[data-t="offerList"]').innerHTML = t.offerList.map(li=>`<li>${li}</li>`).join('');

  document.querySelector('[data-t="skillsTitle"]').textContent=t.skillsTitle;
  renderAccordion(t.skillsCats);

  document.querySelector('[data-t="contactTitle"]').textContent=t.contactTitle;
  document.querySelector('[data-t="contactText"]').textContent=t.contactText;
  document.querySelector('[data-t="btnTalk"]').textContent=t.btnTalk;
  document.querySelector('[data-t="btnEmail"]').textContent=t.btnEmail;
  document.querySelector('[data-t="btnLinkedIn"]').textContent=t.btnLinkedIn;
}
applyLang('es');
document.getElementById("langSwitcher").addEventListener("change",(e)=>applyLang(e.target.value));

/* ========== Preferencia de animaci√≥n (ON/OFF) ========== */
(function(){
  const btn = document.getElementById('animToggle');
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  let saved = localStorage.getItem(MOTION_KEY);
  let startOff = prefersReduced && saved !== 'on';
  if(saved === 'off') startOff = true;
  function apply(off){
    motionOff = !!off;
    document.body.dataset.motion = off ? 'off' : 'on';
    const onLabel  = btn.getAttribute('data-on-label')  || '‚ö° Animaci√≥n: ON';
    const offLabel = btn.getAttribute('data-off-label') || 'üåô Animaci√≥n: OFF';
    btn.setAttribute('aria-pressed', off ? 'true' : 'false');
    btn.textContent = off ? offLabel : onLabel;
    btn.title = off ? 'Activar animaci√≥n' : 'Desactivar animaci√≥n';
    localStorage.setItem(MOTION_KEY, off ? 'off' : 'on');
  }
  apply(startOff);
  window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', e=>{
    const sysOff = e.matches;
    const userPref = localStorage.getItem(MOTION_KEY);
    if(userPref === null){ apply(sysOff); }
  });
  btn.addEventListener('click', ()=> apply(!motionOff));
})();

/* ========== Canvas: 2 cometas ========== */
(function(){
  const canvas = document.getElementById('starLinkCanvas');
  const starsWrap = document.querySelector('.stars');
  if(!canvas || !starsWrap) return;

  const ctx = canvas.getContext('2d');
  let W=0, H=0, DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
  const neonLine = getComputedStyle(document.documentElement).getPropertyValue('--neonline').trim() || '#ff1744';

  function resize(){
    const Wcss = Math.max(document.documentElement.scrollWidth, document.documentElement.clientWidth, window.innerWidth);
    const Hcss = Math.max(document.documentElement.scrollHeight, document.documentElement.clientHeight, window.innerHeight);
    W = Math.round(Wcss); H = Math.round(Hcss);
    canvas.width = Math.round(W * DPR);
    canvas.height = Math.round(H * DPR);
    canvas.style.width = W+'px';
    canvas.style.height = H+'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
    ctx.lineCap = 'round';
  }
  resize();
  window.addEventListener('resize', resize);

  function getStarPoints(){
    const nodes = starsWrap.querySelectorAll('.star');
    const pts = [];
    nodes.forEach(n=>{
      const left = parseFloat(n.style.left||'0');
      const top  = parseFloat(n.style.top ||'0');
      if(!isNaN(left) && !isNaN(top)){
        pts.push({ x:(left/100)*W, y:(top/100)*H });
      }
    });
    return pts.length ? pts : [{x:W*0.3,y:H*0.3},{x:W*0.7,y:H*0.7}];
  }
  let points = getStarPoints();

  const RAYS = 2, SPEED = 650;
  const DUR_MIN = 0.36, DUR_MAX = 1.5, MIN_DIST = 40, TABU_LEN = 3;
  const ANGLE_MIN = Math.PI/6, ANGLE_MAX = (5*Math.PI)/6;
  const BASE_WIDTH = 1.2, TRAIL_LEN = 36, TRAIL_FADE = 0.9;
  const CURVE_MIN = 14, CURVE_MAX = 30, K_NEAREST = 15;
  const OFFSCREEN_TIMEOUT = 1200, VIEW_MARGIN = 200;
  const EASE = t => t<.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;

  const rr=(a,b)=>a+Math.random()*(b-a);
  const sgn=()=>Math.random()<0.5?-1:1;
  const viewport=()=>{const top=window.scrollY,bottom=top+innerHeight;return{left:-VIEW_MARGIN,right:innerWidth+VIEW_MARGIN,top:top-VIEW_MARGIN,bottom:bottom+VIEW_MARGIN}};
  const isVisiblePoint=(p,vp)=>p.x>=vp.left&&p.x<=vp.right&&p.y>=vp.top&&p.y<=vp.bottom;
  const visibleIndices=(vp)=>{const idx=[];for(let i=0;i<points.length;i++){if(isVisiblePoint(points[i],vp)) idx.push(i);}return idx;};

  function pickKthNearest(fromIdx, prevDir, tabu, candidateIdx){
    const from = points[fromIdx];
    const baseIdx = candidateIdx && candidateIdx.length ? candidateIdx.filter(i => i !== fromIdx) : [...Array(points.length).keys()].filter(i => i !== fromIdx);
    const sorted = baseIdx.map(i => ({ i, d2: (points[i].x-from.x)**2 + (points[i].y-from.y)**2 })).sort((a,b)=>a.d2-b.d2);
    const valid = [];
    for (const cand of sorted){
      if (tabu.has(cand.i)) continue;
      const dx = points[cand.i].x - from.x, dy = points[cand.i].y - from.y;
      const dist = Math.hypot(dx,dy); if (dist < MIN_DIST) continue;
      if (prevDir){
        const m = Math.hypot(dx,dy) || 1, vx = dx/m, vy = dy/m;
        const dot = Math.max(-1, Math.min(1, prevDir[0]*vx + prevDir[1]*vy));
        const ang = Math.acos(dot);
        if (ang < ANGLE_MIN || ang > ANGLE_MAX) continue;
      }
      valid.push(cand.i);
    }
    if (valid.length >= K_NEAREST) return valid[K_NEAREST - 1];
    if (valid.length > 0) return valid[valid.length - 1];
    return sorted.length ? sorted[0].i : fromIdx;
  }

  function makeRay(){
    points = getStarPoints();
    const startIdx = Math.floor(Math.random()*points.length);
    return { fromIdx:startIdx, toIdx:null, t0:performance.now(), dur:1, prevDir:null, tabu:new Set(), trail:[], curveAmp:rr(CURVE_MIN, CURVE_MAX)*sgn(), offStart:0 };
  }

  function startHop(ray){
    if (!ray.tabu.has(ray.fromIdx)){
      ray.tabu.add(ray.fromIdx);
      if (ray.tabu.size > TABU_LEN){
        const arr=[...ray.tabu]; arr.shift(); ray.tabu=new Set(arr);
      }
    }
    const vp = viewport();
    let cand = visibleIndices(vp);
    if (cand.length < 30) cand = null;
    const nextIdx = pickKthNearest(ray.fromIdx, ray.prevDir, ray.tabu, cand);
    ray.toIdx = nextIdx;

    const a = points[ray.fromIdx], b = points[ray.toIdx];
    const dist = Math.max(MIN_DIST, Math.hypot(b.x-a.x, b.y-a.y));
    const rawDur = dist / SPEED;
    ray.dur = Math.max(DUR_MIN, Math.min(DUR_MAX, rawDur));
    ray.t0 = performance.now();
    ray.curveAmp = rr(CURVE_MIN, CURVE_MAX) * sgn();
  }

  function advance(ray){
    const a = points[ray.fromIdx], b = points[ray.toIdx];
    ray.prevDir = (()=>{
      const d = Math.hypot(b.x-a.x,b.y-a.y)||1;
      return [(b.x-a.x)/d,(b.y-a.y)/d];
    })();
    ray.fromIdx = ray.toIdx;
    startHop(ray);
  }

  function getPos(ray, prog){
    const p = points[ray.fromIdx], q = points[ray.toIdx];
    const t = EASE(prog);
    const x = p.x + (q.x - p.x)*t;
    const y = p.y + (q.y - p.y)*t;
    const dx = q.x - p.x, dy = q.y - p.y;
    const m = Math.hypot(dx,dy)||1; const ux=dx/m, uy=dy/m;
    const nx = -uy, ny = ux;
    const offset = Math.sin(t*Math.PI) * ray.curveAmp;
    return { x: x + nx*offset, y: y + ny*offset };
  }

  function drawComet(ray, head){
    const L = ray.trail.length;
    for(let i=1;i<L;i++){
      const a = ray.trail[i-1], b = ray.trail[i];
      const k = i/L;
      ctx.save();
      ctx.strokeStyle = neonLine;
      ctx.shadowColor = neonLine;
      ctx.globalAlpha = (k*TRAIL_FADE)*0.9;
      ctx.shadowBlur = 16*k;
      ctx.lineWidth =  BASE_WIDTH * (k*0.9);
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.stroke();
      ctx.restore();
    }
    const last = ray.trail[L-2] || head;
    ctx.save();
    ctx.strokeStyle = neonLine;
    ctx.shadowColor = neonLine;
    ctx.globalAlpha = 1;
    ctx.shadowBlur = 20;
    ctx.lineWidth = BASE_WIDTH;
    ctx.beginPath();
    ctx.moveTo(last.x, last.y);
    ctx.lineTo(head.x, head.y);
    ctx.stroke();
    ctx.fillStyle = neonLine;
    ctx.shadowBlur = 12;
    ctx.beginPath();
    ctx.arc(head.x, head.y, 1.3, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  let rays = Array.from({length:RAYS}, makeRay);
  rays.forEach(r => startHop(r));

  function loop(now){
    if (motionOff || document.body.dataset.motion === 'off'){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      requestAnimationFrame(loop);
      return;
    }
    points = getStarPoints();
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const vpNow = viewport();

    for (const ray of rays){
      const elapsed = (now - ray.t0)/1000;
      const prog = Math.min(1, elapsed / ray.dur);
      const head = getPos(ray, prog);

      if (!isVisiblePoint(head, vpNow)) {
        if (!ray.offStart) ray.offStart = now;
      } else {
        ray.offStart = 0;
      }
      if (ray.offStart && (now - ray.offStart) > 1200) {
        const vis = visibleIndices(vpNow);
        if (vis.length) {
          let best = vis[0], bestD = Infinity;
          for (const i of vis){
            const d = (points[i].x - head.x)**2 + (points[i].y - head.y)**2;
            if (d < bestD) { bestD = d; best = i; }
          }
          ray.fromIdx = best;
          ray.prevDir = null;
          ray.trail = [];
          ray.offStart = 0;
          startHop(ray);
          continue;
        }
      }

      ray.trail.push(head);
      if (ray.trail.length > 36) ray.trail.shift();

      drawComet(ray, head);

      if (prog >= 1){
        ray.trail = [head];
        advance(ray);
      }
    }
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();

/* ========== Bot√≥n Volver Arriba ========== */
(function(){
  const btn = document.getElementById('backTop');
  if(!btn) return;
  const SHOW_AT = 300;
  let ticking = false;
  function setVisible(v){ btn.classList.toggle('is-visible', v); }
  function onScroll(){
    if(!ticking){
      requestAnimationFrame(()=>{ setVisible(window.scrollY > SHOW_AT); ticking = false; });
      ticking = true;
    }
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();
  btn.addEventListener('click', ()=>{
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const motionOff = document.body.dataset.motion === 'off';
    const behavior = (prefersReduced || motionOff) ? 'auto' : 'smooth';
    window.scrollTo({ top: 0, left: 0, behavior });
  });
})();

/* ========== Carrusel ‚ÄúSobre m√≠‚Äù (AUTO) ========== */
(function(){
  const root = document.querySelector('#about .carousel');
  if(!root) return;
  const track  = root.querySelector('.carousel__track');
  const slides = [...root.querySelectorAll('.carousel__slide')];
  let idx = 0, timer = null;
  const DUR = [25000, 20000, 6000]; // ms por slide

  function update(){
    track.style.transform = `translateX(${-idx*100}%)`;
  }
  function scheduleNext(){
    clearTimeout(timer);
    const wait = DUR[idx] ?? 6000;
    timer = setTimeout(()=>{
      idx = (idx + 1) % slides.length;
      update();
      scheduleNext();
    }, wait);
  }
  update();
  scheduleNext();

  document.addEventListener('visibilitychange', ()=>{
    if (document.hidden){ clearTimeout(timer); }
    else { scheduleNext(); }
  });
  window.addEventListener('resize', update);
})();
  /* ========== Canvas: 2 cometas ========== */
(function(){
  const canvas = document.getElementById('starLinkCanvas');
  const starsWrap = document.querySelector('.stars');
  if(!canvas || !starsWrap) return;

  const ctx = canvas.getContext('2d');
  let W=0, H=0, DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
  const neonLine = getComputedStyle(document.documentElement).getPropertyValue('--neonline').trim() || '#ff1744';

  function resize(){
    const Wcss = Math.max(document.documentElement.scrollWidth, document.documentElement.clientWidth, window.innerWidth);
    const Hcss = Math.max(document.documentElement.scrollHeight, document.documentElement.clientHeight, window.innerHeight);
    W = Math.round(Wcss); H = Math.round(Hcss);
    canvas.width = Math.round(W * DPR);
    canvas.height = Math.round(H * DPR);
    canvas.style.width = W+'px';
    canvas.style.height = H+'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
    ctx.lineCap = 'round';
  }
  resize();
  window.addEventListener('resize', resize);

  function getStarPoints(){
    const nodes = starsWrap.querySelectorAll('.star');
    const pts = [];
    nodes.forEach(n=>{
      const left = parseFloat(n.style.left||'0');
      const top  = parseFloat(n.style.top ||'0');
      if(!isNaN(left) && !isNaN(top)){
        pts.push({ x:(left/100)*W, y:(top/100)*H });
      }
    });
    return pts.length ? pts : [{x:W*0.3,y:H*0.3},{x:W*0.7,y:H*0.7}];
  }
  let points = getStarPoints();

  // ===== Par√°metros =====
  const RAYS = 2, SPEED = 650;
  const DUR_MIN = 0.36, DUR_MAX = 1.5, MIN_DIST = 40, TABU_LEN = 3;
  const ANGLE_MIN = Math.PI/6, ANGLE_MAX = (5*Math.PI)/6;
  const BASE_WIDTH = 1.2, TRAIL_LEN = 36, TRAIL_FADE = 0.9;
  const CURVE_MIN = 14, CURVE_MAX = 30, K_NEAREST = 15;
  const OFFSCREEN_TIMEOUT = 1200, VIEW_MARGIN = 200;
  const EASE = t => t<.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;

  const norm = (vx,vy)=>{ const m=Math.hypot(vx,vy)||1; return [vx/m, vy/m]; };
  const rr   = (a,b)=> a + Math.random()*(b-a);
  const sgn  = ()=> Math.random()<0.5 ? -1 : 1;

  const viewport = ()=> {
    const top = window.scrollY, bottom = top + innerHeight;
    return { left:-VIEW_MARGIN, right:innerWidth+VIEW_MARGIN, top:top-VIEW_MARGIN, bottom:bottom+VIEW_MARGIN };
  };
  const isVisiblePoint = (p,vp)=> p.x>=vp.left && p.x<=vp.right && p.y>=vp.top && p.y<=vp.bottom;
  const visibleIndices = (vp)=>{ const idx=[]; for(let i=0;i<points.length;i++){ if(isVisiblePoint(points[i], vp)) idx.push(i); } return idx; };

  function pickKthNearest(fromIdx, prevDir, tabu, candidateIdx){
    const from = points[fromIdx];
    const baseIdx = candidateIdx && candidateIdx.length ? candidateIdx.filter(i => i !== fromIdx) : [...Array(points.length).keys()].filter(i => i !== fromIdx);
    const sorted = baseIdx.map(i => ({ i, d2: (points[i].x-from.x)**2 + (points[i].y-from.y)**2 })).sort((a,b)=>a.d2-b.d2);
    const valid = [];
    for (const cand of sorted){
      if (tabu.has(cand.i)) continue;
      const dx = points[cand.i].x - from.x, dy = points[cand.i].y - from.y;
      const dist = Math.hypot(dx,dy); if (dist < MIN_DIST) continue;
      if (prevDir){
        const m = Math.hypot(dx,dy) || 1, vx = dx/m, vy = dy/m;
        const dot = Math.max(-1, Math.min(1, prevDir[0]*vx + prevDir[1]*vy));
        const ang = Math.acos(dot);
        if (ang < ANGLE_MIN || ang > ANGLE_MAX) continue;
      }
      valid.push(cand.i);
    }
    if (valid.length >= K_NEAREST) return valid[K_NEAREST - 1];
    if (valid.length > 0) return valid[valid.length - 1];
    return sorted.length ? sorted[0].i : fromIdx;
  }

  function makeRay(){
    points = getStarPoints();
    const startIdx = Math.floor(Math.random()*points.length);
    return { fromIdx: startIdx, toIdx: null, t0: performance.now(), dur: 1, prevDir: null, tabu: new Set(), trail: [], curveAmp: rr(CURVE_MIN, CURVE_MAX) * sgn(), offStart: 0 };
  }

  function startHop(ray){
    if (!ray.tabu.has(ray.fromIdx)){
      ray.tabu.add(ray.fromIdx);
      if (ray.tabu.size > TABU_LEN){
        const arr=[...ray.tabu]; arr.shift(); ray.tabu=new Set(arr);
      }
    }
    const vp = viewport();
    let cand = visibleIndices(vp);
    if (cand.length < 30) cand = null;
    const nextIdx = pickKthNearest(ray.fromIdx, ray.prevDir, ray.tabu, cand);
    ray.toIdx = nextIdx;

    const a = points[ray.fromIdx], b = points[ray.toIdx];
    const dist = Math.max(MIN_DIST, Math.hypot(b.x-a.x, b.y-a.y));
    const rawDur = dist / SPEED;
    ray.dur = Math.max(DUR_MIN, Math.min(DUR_MAX, rawDur));
    ray.t0 = performance.now();
    ray.curveAmp = rr(CURVE_MIN, CURVE_MAX) * sgn();
  }

  function advance(ray){
    const a = points[ray.fromIdx], b = points[ray.toIdx];
    ray.prevDir = norm(b.x-a.x, b.y-a.y);
    ray.fromIdx = ray.toIdx;
    startHop(ray);
  }

  function getPos(ray, prog){
    const p = points[ray.fromIdx], q = points[ray.toIdx];
    const t = EASE(prog);
    const x = p.x + (q.x - p.x)*t;
    const y = p.y + (q.y - p.y)*t;
    const dx = q.x - p.x, dy = q.y - p.y;
    const [ux,uy] = norm(dx,dy);
    const nx = -uy, ny = ux;
    const offset = Math.sin(t*Math.PI) * ray.curveAmp;
    return { x: x + nx*offset, y: y + ny*offset };
  }

  function drawComet(ray, head){
    const L = ray.trail.length;
    for(let i=1;i<L;i++){
      const a = ray.trail[i-1], b = ray.trail[i];
      const k = i/L;
      ctx.save();
      ctx.strokeStyle = neonLine;
      ctx.shadowColor = neonLine;
      ctx.globalAlpha = (k*TRAIL_FADE)*0.9;
      ctx.shadowBlur = 16*k;
      ctx.lineWidth = BASE_WIDTH * (k*0.9);
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.stroke();
      ctx.restore();
    }
    const last = ray.trail[L-2] || head;
    ctx.save();
    ctx.strokeStyle = neonLine;
    ctx.shadowColor = neonLine;
    ctx.globalAlpha = 1;
    ctx.shadowBlur = 20;
    ctx.lineWidth = BASE_WIDTH;
    ctx.beginPath();
    ctx.moveTo(last.x, last.y);
    ctx.lineTo(head.x, head.y);
    ctx.stroke();
    ctx.fillStyle = neonLine;
    ctx.shadowBlur = 12;
    ctx.beginPath();
    ctx.arc(head.x, head.y, 1.3, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  let rays = Array.from({length:RAYS}, makeRay);
  rays.forEach(r => startHop(r));

  function loop(now){
    if (motionOff || document.body.dataset.motion === 'off'){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      requestAnimationFrame(loop);
      return;
    }

    points = getStarPoints();
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const vpNow = viewport();

    for (const ray of rays){
      const elapsed = (now - ray.t0)/1000;
      const prog = Math.min(1, elapsed / ray.dur);
      const head = getPos(ray, prog);

      if (!isVisiblePoint(head, vpNow)) {
        if (!ray.offStart) ray.offStart = now;
      } else {
        ray.offStart = 0;
      }
      if (ray.offStart && (now - ray.offStart) > OFFSCREEN_TIMEOUT) {
        const vis = visibleIndices(vpNow);
        if (vis.length) {
          let best = vis[0], bestD = Infinity;
          for (const i of vis){
            const d = (points[i].x - head.x)**2 + (points[i].y - head.y)**2;
            if (d < bestD) { bestD = d; best = i; }
          }
          ray.fromIdx = best;
          ray.prevDir = null;
          ray.trail = [];
          ray.offStart = 0;
          startHop(ray);
          continue;
        }
      }

      ray.trail.push(head);
      if (ray.trail.length > TRAIL_LEN) ray.trail.shift();

      drawComet(ray, head);

      if (prog >= 1){
        ray.trail = [head];
        advance(ray);
      }
    }
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();

</script>
</body>
</html>
